# Bugs, workarounds and project's decisions

| Date/Type | Description |
| --------- | ----------- |
| 09.01.2021 Decision | [php-coder/mystamps#1495](https://github.com/php-coder/mystamps/issues/1495): Let's move **generated images** for the diagrams to the separate branch (`generated-assets`). Later we can apply this approach for other generated content (reports, for example). Pros: it reduces a disk space/repository size because we always hold only the latest version of the images. We will use force-push for rewriting data. Cons: it makes diagram update (especially with PRs) a little more complex because it requires 2 commits (PRs). Commits: [6e7e149f](https://github.com/php-coder/mystamps/commit/6e7e149f84756a6fd817dc23e6e80c145783c784) |
| 20.06.2020 Decision | When I released 0.4 version after 5 years of development, I decided to [**make releases often**](https://en.wikipedia.org/wiki/Release_early,_release_often): every 3 months. In case when some planned issues haven't been implemented, they should be postponed to the next release and they shouldn't delay a release. Starting from 0.4.5 I've decided to make releases even more frequently -- *every 2 months*. This will improve our confidence that the release procedures are up-to-date. |
| 20.06.2020 Decision | [php-coder/mystamps#1159](https://github.com/php-coder/mystamps/issues/1159): based on experience, most of time when I made a dependency update, I spent on reading a list of changes. This came especially notable with Spring Boot updates when reading might took 85-90% of time because I had to read also changelogs of Spring Framework, Spring Security and sometimes other libraries. As a consequence of this approach, at this moment, we use old and unsupported Spring Boot version (2.0.x) while the current one is 2.3.x Decision: in order to keep up with new releases, we should sacrify the pedancy and a full understanding of the changes that happen with our dependencies. **Reading of changelogs** should be an optional and if an update passed the integration tests, this is enough level of confidence. |
| 23.05.2020 Workaround | [php-coder/mystamps#1326](https://github.com/php-coder/mystamps/issues/1326): unfortunately, by default double quotes work differently on **MySQL** (the arguments are treated as strings) in contrast to other databases and our "fix" fixed nothing. To have a similar behavior we can set `sql_mode` to [`ANSI_QUOTES`](https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_ansi_quotes). Workaround: let's simply rename the field from `condition` to `cond` because additional configuration of a database (or [a connection](https://stackoverflow.com/questions/58727070/how-to-dynamic-setting-sql-mode-for-mysql-in-springboot-program)) unnecessary complicates the setup. See also: [When to use single quotes, double quotes, and backticks in MySQL]( https://stackoverflow.com/questions/11321491/when-to-use-single-quotes-double-quotes-and-backticks-in-mysql). Extra decision: let's keep `DATABASE_TO_UPPER=false` parameter for **H2** as I prefer to see tables names in a lower case. Commits: [89ba68c0](https://github.com/php-coder/mystamps/commit/89ba68c0e11d59da55404614072f9eb757484243) |
| 22.05.2020 Workaround | [php-coder/mystamps#1326](https://github.com/php-coder/mystamps/issues/1326): when we decided to use double quotes for the `condition` field, we broke such queries on **H2**. This is because it behaves like Oracle and [converts unquoted identifiers to an upper case](https://stackoverflow.com/questions/10789994/make-h2-treat-quoted-name-and-unquoted-name-as-the-same), so the field is called `CONDITION` and when we quote it (`"condition"`), H2 couldn't find it because usage of the double quotes makes a field name case sensitive. Workaround: pass [`DATABASE_TO_UPPER=false`](https://www.h2database.com/javadoc/org/h2/engine/DbSettings.html#DATABASE_TO_UPPER) parameter to H2 to disable such behavior and be consistent with MySQL/PostgreSQL. Commits: [87df2dfa](https://github.com/php-coder/mystamps/commit/87df2dfabae9ef672fc8910139f3aadb46dd27d1) |
| 22.05.2020 Workaround | [php-coder/mystamps#1326](https://github.com/php-coder/mystamps/issues/1326): the field `condition` [has been added](https://github.com/php-coder/mystamps/commit/5648a0b121544e5326b22e801b0c23c502b59e3f) in order to persist a series condition. When we [started to use](https://github.com/php-coder/mystamps/commit/28eab066225a717d93fc95af2d947e45944f3ad1) the field, it has turned out that the SQL queries fail on **MySQL** because `condition` is a reserved keyword and should be quoted. We couldn't use apostrophes because it doesn't work on other databases. There was idea to rename the field to `cond`. Workaround: let's just double quote the field name as it should work everywhere and it's simpler. Commits: [74734a8d](https://github.com/php-coder/mystamps/commit/74734a8dc4071e9139efdf932750929869e9a370) |
| 22.05.2020 Workaround | [php-coder/mystamps#1398](https://github.com/php-coder/mystamps/issues/1398): After we switched to use HTTPS for a **0pdd** badge, it didn't show up in README.md file. Workaround: get back to using of HTTP in a link. Bug: [yegor256/0pdd#289](https://github.com/yegor256/0pdd/issues/289) Commits: [2d53575d](https://github.com/php-coder/mystamps/commit/2d53575d1c6a7b8ee9681d438fc4622e799e36c5) |
| 07.04.2020 Decision   | Add new type of change of commits: `improve` We need this because many changes in a series import are naturally fit into this category: they aren't new features as they are small, they aren't bugs as they were discovered during site usage. Unfortunately there is no related type in the current conventional commits specification. See discussions: [conventional-commits/conventionalcommits.org#66](https://github.com/conventional-commits/conventionalcommits.org/issues/66) and [conventional-commits/conventionalcommits.org#78](https://github.com/conventional-commits/conventionalcommits.org/issues/78)
| 07.03.2020 Workaround | [php-coder/mystamps#1072](https://github.com/php-coder/mystamps/issues/1072): AJAX-related tests don't work in **htmlunit** and fail with `ReferenceError: "Headers" is not defined`. When the code got updated to use another version of constructor of `Headers` class, tests fail with error `ReferenceError: "fetch" is not defined` error. Bug: [HtmlUnit/htmlunit#78](https://github.com/HtmlUnit/htmlunit/issues/78) Workaround: because "the fetch api is not supported so far", let's use axios library instead. Commits: [f224e94](https://github.com/php-coder/mystamps/commit/f224e944b367036458ce9d7ce0c596504766ef8e) |
| ~~07.03.2020 Workaround~~ | ~~[php-coder/mystamps#1072](https://github.com/php-coder/mystamps/issues/1072): `sendKeys()` method from **htmlunit** fails with `StringIndexOutOfBoundsException: start > length()` exception when we fill a field again. Bug: [HtmlUnit/htmlunit#142](https://github.com/HtmlUnit/htmlunit/issues/142) Workaround: open a page on every test to avoid a state from other tests. Commits: [943afba](https://github.com/php-coder/mystamps/commit/943afba4f60b3df47e678a274186b80702e7562c)~~<br/>UPDATE(19.01.2021): in [dd61abf5](https://github.com/php-coder/mystamps/commit/dd61abf577e115a2d935fd0bc6d1f233046e6e85) the workaround has been reverted as since [c7e61df8](https://github.com/php-coder/mystamps/commit/c7e61df884ee4c1d418c5eacbb0267b98f75f1f0) we have the version that doesn't contain this bug |
| 09.02.2020 Workaround | **pdd** fails to parse files in charsets other than UTF-8 with error `invalid byte sequence in UTF-8`. Workaround: exclude `src/test/wiremock` directory. Bug: [yegor256/pdd#143](https://github.com/yegor256/pdd/issues/143) Commits: [30aab7d](https://github.com/php-coder/mystamps/commit/30aab7dc8c265804efef382422e7cae9e53187f3), [ab563b6](https://github.com/php-coder/mystamps/commit/ab563b653279625120121babccdfd915181ee46d) |
| 07.02.2020 Workaround | [php-coder/mystamps#1248](https://github.com/php-coder/mystamps/issues/1248): **wiremock** logs warnings for static resources when there is no stub mapping. Workaround: create mappings for such resources. Bug: [tomakehurst/wiremock#1247](https://github.com/tomakehurst/wiremock/issues/1247) Commits: [0018ad4](https://github.com/php-coder/mystamps/commit/0018ad44a21379b8179f94e954795c66b6d50bbc) |
| ~~24.11.2019 Workaround~~ | ~~[php-coder/mystamps#1156](https://github.com/php-coder/mystamps/issues/1156) After updating **html5validator** to 0.3.2, the `--ignore-re` has stopped to work. Workaround: revert and pin the version to 0.3.1 Bug: [svenkreiss/html5validator#64](https://github.com/svenkreiss/html5validator/issues/64) Commits: [9a0d695](https://github.com/php-coder/mystamps/commit/9a0d695ccac1deeba0c4280779bbac11ebf3ac4d)~~<br/> UPDATE(22.12.2020): in [61c97a4f](https://github.com/php-coder/mystamps/commit/61c97a4f2435e7cdf17c0ad6866f7b99cb640e3b) ([#1169](https://github.com/php-coder/mystamps/issues/1169)) html5validator has been updated to 0.3.3 that fixed the issue |
| 23.12.2018 Decision | [php-coder/mystamps#967](https://github.com/php-coder/mystamps/issues/967) "Show similar series" feature has been added with the following notes:<br/>- there is no limit for a number of series that will be displayed. I thought about limiting to 3 but I decided to leave it as-is for now<br/>- the order of the series isn't defined. In the initial idea, I thought about showing only 3 series in a random order but it's hard to implement in a database-agnostic way<br/>Commits: [054f826e](https://github.com/php-coder/mystamps/commit/054f826ef6706f82b4a7c04d73715d161d0c1a28) |
| 29.09.2018 Workaround | After [upgrade of **mysql-connector-java** to 5.1.47](https://github.com/php-coder/mystamps/commit/21e3a7a361990d6059cb7668c1217f653bd0ae8f), the bug that [causes NullPointerException](https://travis-ci.org/php-coder/mystamps/jobs/435000067) was revealed. I reverted the version back to 5.1.46 Issue: https://bugs.mysql.com/bug.php?id=92089 Commits: [3cb0dac9](https://github.com/php-coder/mystamps/commit/3cb0dac9fb62bbc12331b7ea1378f3b56746714d) |
| 30.12.2017 Workaround | [php-coder/mystamps#772](https://github.com/php-coder/mystamps/issues/772) Because **Travis CI** has **MySQL** version 5.6.43, we can't have a unique index on a column that has a length that exceeds 767 bytes. Our production server is running on 5.7.20 that doesn't have such limitation. In order to be able to run migrations on all the environments, I set type of the `series_import_requests.url` column to `VARCHAR(767)` (instead of `VARCHAR(768)` or `VARCHAR(1024)` as I wanted before). Commits: [33dd9025](https://github.com/php-coder/mystamps/commit/33dd902500501d3fdc3a744229ad921982adbc01) |
| 20.07.2017 Decision | [php-coder/mystamps#423](https://github.com/php-coder/mystamps/issues/423) Most of our **checks on CI** now get executed only when files of a certain type were modified. This should give us a faster feedback loop. Checks are also being run when their configuration has been changed. If check performed by a maven plugin, it will be always run when `pom.xml` is modified. The same logic applies to the tools that are being installed from the `.travis.yml` file. Unfortunately, we have to unconditionally run checks even if a change in a file wasn't related to the plugin/tool configuration. Also there is no way to disable skipping logic and if you need to run a specific check there is no way to force its execution. I was thinking about introducing an environment variable or using a special magic comment from a commit message but I decided to leave it as-is for a now (although it can be added later). Commits: [7da91a53](https://github.com/php-coder/mystamps/commit/7da91a53a1d7f43670d67adfce359814fa7ee27a) |
| 06.01.2017 Workaround | [php-coder/mystamps#434](https://github.com/php-coder/mystamps/issues/434) I was needed to render categories with its subcategories. Database returns data in a form (sub category name + category name or null). It turns out that it's impossible to render this data with **Thymeleaf** as a `<select>` with `<optgroup>` elements. I had to do data transformation inside of a service method. Commits: [b7fe1dac](https://github.com/php-coder/mystamps/commit/b7fe1dac7a7f0bc09e9e153a8408687fd899c79f) Example: https://gist.github.com/php-coder/d3020e4d8d00b8c5befe755c46f06f1b |
| 28.09.2016 Workaround | Because **Travis CI** has **MySQL** version 5.5.53 (that is less than 5.6.5 but the latest for Ubuntu 12.04), we couldn't create a column with `NOW()` as a default value. We did the same in 3 steps to support this old version. Commits: [d55cd6cc](https://github.com/php-coder/mystamps/commit/d55cd6cc0842bc938c5c30f9aaaf78697ba84f45), [566d72f0](https://github.com/php-coder/mystamps/commit/566d72f053d785afb58234a6c7d69510a35bb7c4) |
| 30.01.2016 Workaround | **html5validator** complained about `An "img" element must have an "alt" attribute`. I've suppressed this error until [php-coder/mystamps#314](https://github.com/php-coder/mystamps/issues/314) is fixed. Commits: [ec40a6ad](https://github.com/php-coder/mystamps/commit/ec40a6ad431b77c922195bd3225a4963416cea43) |
